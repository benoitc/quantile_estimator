<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<title>.eunit/quantile.COVER.html</title>
</head><body style='background-color: white; color: black'>
<pre>
File generated from /Users/odo/2f/quantile_estimator/.eunit/quantile.erl by COVER 2013-02-18 at 18:22:49

****************************************************************************

        |  -module(quantile).
        |  -author('Florian Odronitz &lt;odo@mac.com&gt;').
        |  
        |  -ifdef(TEST).
        |  -include_lib("eunit/include/eunit.hrl").
        |  -export([ceil/1]).
        |  -define(DEBUG, true).
        |  -endif.
        |  
        |  -type sample() :: number().
        |  -type samples() :: [sample()].
        |  
        |  -export([quantile/2]).
        |  -export([rank_average/2]).
        |  
        |  -spec quantile(float(), samples()) -&gt; sample().
        |  quantile(0.0, [First|_]) -&gt;
<font color=red>     0..|  	First;</font>
        |  
        |  quantile(1.0, Samples) -&gt;
<font color=red>     0..|  	lists:last(Samples);</font>
        |  	
        |  quantile(Quantile, Samples) -&gt;
   270..|  	case ranks(length(Samples), Quantile) of
        |  		[Index] -&gt;
    16..|  			lists:nth(Index, Samples);
        |  		[Index1, Index2] -&gt;
   254..|  			(lists:nth(Index1, Samples) + lists:nth(Index2, Samples)) / 2
        |  	end.
        |  
        |  -spec even(integer()) -&gt; boolean().
        |  even(Value) -&gt;
   264..|  	Value rem 2 =:= 0.
        |  
        |  -spec natural(float()) -&gt; boolean().
        |  natural(Value) -&gt;
   290..|  	(erlang:trunc(Value) * 1.0) =:= Value.
        |  
        |  -spec ranks(integer(), float()) -&gt; [integer()] | [integer()|integer()].
        |  ranks(Size, _Quantile) when Size &lt; 1 -&gt;
<font color=red>     0..|  	throw({error, {Size, size_smaller_one}});</font>
        |  
        |  ranks(_Size, Quantile) when Quantile &lt; 0 -&gt;
<font color=red>     0..|  	throw({error, {Quantile, quantile_smaller_zero}});</font>
        |  
        |  ranks(_Size, Quantile) when Quantile &gt; 1 -&gt;
<font color=red>     0..|  	throw({error, {Quantile, quantile_larger_one}});</font>
        |  
        |  ranks(Size, Quantile) -&gt;
   282..|  	case natural(Size * Quantile) andalso even(Size) of
        |  		true -&gt;
   256..|  			[round(Size * Quantile), round(Size * Quantile) + 1];
        |  		false -&gt;
    26..|  			[ceil(Size * Quantile)]
        |  	end.
        |  
        |  -spec ceil(float()) -&gt; integer().
        |  ceil(X) -&gt;
   162..|      T = erlang:trunc(X),
   162..|      case (X - T) of
     4..|          Neg when Neg &lt; 0 -&gt; T;
   145..|          Pos when Pos &gt; 0 -&gt; T + 1;
    13..|          _ -&gt; T
        |      end.
        |  
        |  
        |  % TESTS
        |  rank_average(Size, Quantile) -&gt;
<font color=red>     0..|  	case ranks(Size, Quantile) of</font>
        |  		[V] -&gt;
<font color=red>     0..|  			V;</font>
        |  		[V1, V2] -&gt;
<font color=red>     0..|  			(V1 + V2) / 2</font>
        |  	end.
        |  
        |  
        |  -ifdef(TEST).
        |  
        |  quantile_test_() -&gt;
     2..|  [{foreach, local,
        |  	fun test_setup/0,
        |  	fun test_teardown/1,
        |  	[
        |  		{"test ceil", fun  ceil_test/0}
        |  		,{"test ranks", fun ranks_test/0}
        |  		,{"test natural", fun natural_test/0}
        |  		,{"test even", fun even_test/0}
        |  		,{"test quantiles", fun quantile_test/0}
        |  	]}
        |  ].
        |  
        |  test_setup() -&gt;
     5..|  	undefined.
        |  
        |  test_teardown(_) -&gt;
     5..|  	undefined.
        |  
        |  ranks_test() -&gt;
     2..|  	?assertEqual([3], ranks(10, 0.25))
     2..|  	,?assertEqual([5, 6], ranks(10, 0.5))
     2..|  	,?assertEqual([8], ranks(10, 0.75))
     2..|  	,?assertEqual([3], ranks(11, 0.25))
     2..|  	,?assertEqual([6], ranks(11, 0.5))
     2..|  	,?assertEqual([9], ranks(11, 0.75)).
        |  
        |  natural_test() -&gt;
     2..|  	?assertEqual(true, natural(10.0))
     2..|  	,?assertEqual(true, natural(-10.0))
     2..|  	,?assertEqual(false, natural(10.1))
     2..|  	,?assertEqual(false, natural(-10.1)).
        |  
        |  even_test() -&gt;
     2..|  	?assertEqual(true, even(10))
     2..|  	,?assertEqual(true, even(-10))
     2..|  	,?assertEqual(false, even(11))
     2..|  	,?assertEqual(false, even(-11)).
        |  
        |  ceil_test() -&gt;
     2..|  	?assertEqual(1, ceil(1.0))
     2..|  	,?assertEqual(2, ceil(1.1))
     2..|  	,?assertEqual(2, ceil(1.8))
     2..|  	,?assertEqual(-1, ceil(-1.8))
     2..|  	,?assertEqual(-1, ceil(-1.1)).
        |  
        |  quantile_test() -&gt;
     2..|  	Samples1 = [3.0, 6.0, 7.0, 8.0, 8.0, 10.0, 13.0, 15.0, 16.0, 20.0]
     2..|  	,?assertEqual(7.0, quantile(1/4, Samples1))
     2..|  	,?assertEqual(9.0, quantile(1/2, Samples1))
     2..|  	,?assertEqual(15.0, quantile(3/4, Samples1))
     2..|  	,Samples2 = [3.0, 6.0, 7.0, 8.0, 8.0, 9.0, 10.0, 13.0, 15.0, 16.0, 20.0]
     2..|  	,?assertEqual(7.0, quantile(1/4, Samples2))
     2..|  	,?assertEqual(9.0, quantile(1/2, Samples2))
     2..|  	,?assertEqual(15.0, quantile(3/4, Samples2))
     2..|  	,?assertEqual(1.0, quantile(1/4, [1.0]))
     2..|  	,?assertEqual(1.0, quantile(2/4, [1.0]))
     2..|  	,?assertEqual(1.0, quantile(3/4, [1.0])).
        |  
        |  -endif.
</pre>
</body>
</html>
